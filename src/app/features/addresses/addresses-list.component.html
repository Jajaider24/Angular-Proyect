<!-- 
  Lista de Direcciones de Entrega
  Muestra tabla con todas las direcciones, con búsqueda, filtros y acciones CRUD
-->
<div class="row">
  <div class="col">
    <!-- Header con título y botón de crear -->
    <div class="card shadow">
      <div class="card-header border-0">
        <div class="row align-items-center">
          <div class="col">
            <h3 class="mb-0">Direcciones de Entrega</h3>
          </div>
          <div class="col text-right">
            <button
              class="btn btn-sm btn-primary"
              (click)="createNew()"
              type="button"
            >
              <i class="ni ni-fat-add"></i> Nueva Dirección
            </button>
          </div>
        </div>
      </div>

      <!-- Barra de búsqueda -->
      <div class="card-header border-0 py-3">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-0">
              <div class="input-group input-group-alternative">
                <div class="input-group-prepend">
                  <span class="input-group-text">
                    <i class="ni ni-zoom-split-in"></i>
                  </span>
                </div>
                <input
                  class="form-control"
                  placeholder="Buscar por calle, ciudad, código postal..."
                  type="text"
                  [(ngModel)]="searchTerm"
                  (input)="onSearch()"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading spinner -->
      <div class="card-body" *ngIf="loading">
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Cargando...</span>
          </div>
          <p class="mt-3 text-muted">Cargando direcciones...</p>
        </div>
      </div>

      <!-- Tabla de direcciones -->
      <div
        class="table-responsive"
        *ngIf="!loading && filteredAddresses.length > 0"
      >
        <table class="table align-items-center table-flush">
          <thead class="thead-light">
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Calle</th>
              <th scope="col">Ciudad</th>
              <th scope="col">Estado</th>
              <th scope="col">Código Postal</th>
              <th scope="col">Order ID</th>
              <th scope="col" class="text-right">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let address of filteredAddresses">
              <!-- ID -->
              <td>
                <span class="badge badge-dot mr-4">
                  <span class="text-dark font-weight-bold"
                    >#{{ address.id }}</span
                  >
                </span>
              </td>

              <!-- Calle -->
              <td>
                <span class="mb-0 text-sm">{{ address.street }}</span>
              </td>

              <!-- Ciudad -->
              <td>
                <span class="mb-0 text-sm">{{ address.city }}</span>
              </td>

              <!-- Estado -->
              <td>
                <span class="mb-0 text-sm">{{ address.state }}</span>
              </td>

              <!-- Código Postal -->
              <td>
                <span class="badge badge-secondary">{{
                  address.postal_code
                }}</span>
              </td>

              <!-- Order ID -->
              <td>
                <span class="badge badge-info"
                  >Order #{{ address.order_id }}</span
                >
              </td>

              <!-- Acciones -->
              <td class="text-right">
                <div class="dropdown">
                  <a
                    class="btn btn-sm btn-icon-only text-light"
                    href="javascript:void(0)"
                    role="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="fas fa-ellipsis-v"></i>
                  </a>
                  <div
                    class="dropdown-menu dropdown-menu-right dropdown-menu-arrow"
                  >
                    <a
                      class="dropdown-item"
                      href="javascript:void(0)"
                      (click)="viewDetail(address.id)"
                    >
                      <i class="ni ni-single-02"></i> Ver Detalle
                    </a>
                    <a
                      class="dropdown-item"
                      href="javascript:void(0)"
                      (click)="editAddress(address.id)"
                    >
                      <i class="ni ni-settings"></i> Editar
                    </a>
                    <div class="dropdown-divider"></div>
                    <a
                      class="dropdown-item text-danger"
                      href="javascript:void(0)"
                      (click)="deleteAddress(address.id)"
                    >
                      <i class="ni ni-fat-remove"></i> Eliminar
                    </a>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensaje cuando no hay resultados -->
      <div class="card-body" *ngIf="!loading && filteredAddresses.length === 0">
        <div class="text-center py-5">
          <i class="ni ni-pin-3 text-muted" style="font-size: 3rem"></i>
          <h4 class="mt-3">No se encontraron direcciones</h4>
          <p class="text-muted">
            {{
              searchTerm
                ? "Intenta con otro término de búsqueda"
                : "Comienza creando una nueva dirección"
            }}
          </p>
          <button
            class="btn btn-primary mt-3"
            (click)="createNew()"
            *ngIf="!searchTerm"
          >
            <i class="ni ni-fat-add"></i> Crear Primera Dirección
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
